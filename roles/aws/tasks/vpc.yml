---

- name: Configure AWS VPC
  ec2_vpc:
    state: "{{ vpc_state }}"
    cidr_block: "{{ vpc_cidr_block }}"
    resource_tags: "{{ vpc_resource_tags }}"
    subnets: "{{ vpc_subnets }}"
    internet_gateway: "{{ vpc_internet_gw }}"
    route_tables: "{{ vpc_route_tables }}"
    region: "{{ ec2_region }}"
  register: vpc

- set_fact:
    vpc_facts: "{{ vpc }}"

- name: Create Internet GW
  ec2_vpc_igw:
    vpc_id: "{{ vpc.vpc_id }}"
    region: "{{ ec2_region }}"
    state: present
  register: igw

- name: Tagging the new internet gateway created
  ec2_tag:
    resource: "{{ igw.gateway_id }}"
    state: present
    region: "{{ ec2_region }}"
    tags:
      Name: dcos-gateway

